(function(a){a.fn.sortableLists=function(s){var E=a("body").css("position","relative"),A={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(E.css("margin-top")),left:0-parseInt(E.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:false,open:"",close:"",openerCss:{"float":"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},maxLevels:false,listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,insertZonePlus:false,scroll:20,ignoreClass:"",addClass:"",remover:{removerClass:"",callback:function(L){return false}},isAllowed:function(L,N,M){return true},onDragStart:function(M,L){return true},onChange:function(L){return true},complete:function(L){return true}},H=a.extend(true,{},A,s),o=a("<"+H.listSelector+" />").prependTo(E).attr("id","s-l-base").css(H.baseCss).addClass(H.listsClass+" "+H.baseClass),x=a("<li />").attr("id","s-l-placeholder").css(H.placeholderCss).addClass(H.placeholderClass),p=a("<li />").attr("id","s-l-hint").css(H.hintCss).addClass(H.hintClass),t=a("<"+H.listSelector+" />").attr("id","s-l-hint-wrapper").addClass(H.listsClass+" "+H.hintWrapperClass).css(H.listsCss).css(H.hintWrapperCss),e=a("<span />").addClass("s-l-opener "+H.opener.openerClass).css(H.opener.openerCss).on("mousedown",function(M){var L=a(this).closest("li");if(L.hasClass("s-l-closed")){r(L)}else{D(L)}return false});if(H.opener.as=="class"){e.addClass(H.opener.close)}else{if(H.opener.as=="html"){e.html(H.opener.close)}else{console.error("jQuerySortableLists opener as background image has been removed with release 2.0.0. Use html instead please.")}}var K={isDragged:false,isRelEFP:null,oEl:null,rootEl:{el:a(this),offset:null,rootElClass:a(this).attr("class")},cEl:null,placeholderParentLi:null,upScroll:false,downScroll:false,pX:0,pY:0,cX:0,cY:0,isAllowed:true,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:a(document),win:a(window),removingItem:{li:null,parentLi:null}};if(H.opener.active){if(!H.opener.open){throw"Opener.open value is not defined. It should be valid url, html or css class."}if(!H.opener.close){throw"Opener.close value is not defined. It should be valid url, html or css class."}var J=null;a(this).find("li").each(function(){J=a(this);if(J.children(H.listSelector).length){e.clone(true).prependTo(J.children("div").first());if(!J.hasClass("s-l-open")){D(J)}else{r(J)}}})}if(H.maxLevels!==false){if(isNaN(H.maxLevels)){throw"JQuery-sortable-lists maxLevels values is not a number"}a(this).find("li").each(function(){k(a(this),I(a(this)));m(a(this),y(a(this)))})}if(H.remover.removerClass){a("."+H.remover.removerClass).on("click",function(L){K.removingItem.li=a(this).closest("li");K.removingItem.parentLi=(!K.removingItem.li.parent().is(K.rootEl.el))?K.removingItem.li.parent().closest("li"):null;if(H.remover.callback(a(this))){K.removingItem.li.remove();c();H.onChange(null);if(H.maxLevels&&K.removingItem.parentLi){g(K.removingItem.parentLi)}}})}return this.on("mousedown",function(O){var N=a(O.target);if(K.isDragged!==false||(H.ignoreClass&&N.hasClass(H.ignoreClass))){return}O.preventDefault();var M=N.closest("li"),L=a(this);if(M[0]){H.onDragStart(O,M);n(O,M,L)}});function n(R,N,M){K.isDragged=true;var T=parseInt(N.css("margin-top")),P=parseInt(N.css("margin-bottom")),L=parseInt(N.css("margin-left")),U=parseInt(N.css("margin-right")),S=N.offset(),Q=N.innerHeight();K.rootEl={el:M,offset:M.offset(),rootElClass:M.attr("class")};K.cEl={el:N,mT:T,mL:L,mB:P,mR:U,offset:S};K.cEl.xyOffsetDiff={X:R.pageX-K.cEl.offset.left,Y:R.pageY-K.cEl.offset.top};K.cEl.el.addClass("s-l-current "+H.currElClass);N.before(x);var O=K.placeholderNode=a("#s-l-placeholder");N.css({width:N.width(),position:"absolute",top:S.top-T,left:S.left-L}).prependTo(o);O.css({display:"block",height:Q});p.css("height",Q);K.doc.on("mousemove",d).on("mouseup",z)}function d(O){if(K.isDragged){var L=K.cEl,N=K.doc,M=K.win;if(!O.pageX){l(O)}if(N.scrollTop()>K.rootEl.offset.top-10&&O.clientY<50){if(!K.upScroll){C(O)}else{O.pageY=O.pageY-H.scroll;a("html, body").each(function(P){a(this).scrollTop(a(this).scrollTop()-H.scroll)});h(O)}}else{if(M.height()-O.clientY<50&&N.scrollTop()+M.height()<K.rootEl.offset.top+K.rootEl.el.outerHeight(false)+10){if(!K.downScroll){w(O)}else{O.pageY=O.pageY+H.scroll;a("html, body").each(function(P){a(this).scrollTop(a(this).scrollTop()+H.scroll)});h(O)}}else{B(K)}}K.oElOld=K.oEl;L.el[0].style.visibility="hidden";K.oEl=oEl=f(O.pageX,O.pageY);L.el[0].style.visibility="visible";j(O,K);u(O,K)}}function z(P){var O=K.cEl,L=a("#s-l-hint",K.rootEl.el),R=p[0].style,Q=null,N=false,M=a("#s-l-hint-wrapper");if(R.display=="block"&&L.length&&K.isAllowed){Q=L;N=true}else{Q=K.placeholderNode;N=false}offset=Q.offset();O.el.animate({left:offset.left-K.cEl.mL,top:offset.top-K.cEl.mT},250,function(){q(O);Q.after(O.el[0]);Q[0].style.display="none";R.display="none";L.remove();M.removeAttr("id").removeClass(H.hintWrapperClass);if(M.length){M.prev("div").append(e.clone(true))}if(N){K.placeholderNode.slideUp(150,function(){K.placeholderParentLi=(!K.placeholderNode.parent().is(K.rootEl.el))?K.placeholderNode.parent().closest("li"):null;K.placeholderNode.remove();c();H.onChange(O.el);H.complete(O.el);K.isDragged=false;if(H.maxLevels!==false){g(O.el);if(K.placeholderParentLi){g(K.placeholderParentLi)}}})}else{K.placeholderNode.remove();c();H.complete(O.el);K.isDragged=false}});B(K);K.doc.unbind("mousemove",d).unbind("mouseup",z)}function C(L){if(K.upScroll){return}K.upScroll=setInterval(function(){K.doc.trigger("mousemove")},50)}function w(L){if(K.downScroll){return}K.downScroll=setInterval(function(){K.doc.trigger("mousemove")},50)}function h(L){K.pY=L.pageY;K.pX=L.pageX;K.cY=L.clientY;K.cX=L.clientX}function l(L){L.pageY=K.pY;L.pageX=K.pX;L.clientY=K.cY;L.clientX=K.cX}function B(L){clearInterval(L.upScroll);clearInterval(L.downScroll);L.upScroll=L.downScroll=false}function u(N,M){var L=M.cEl;L.el.css({top:N.pageY-L.xyOffsetDiff.Y-L.mT,left:N.pageX-L.xyOffsetDiff.X-L.mL})}function f(L,Q){if(!document.elementFromPoint){return null}var P=K.isRelEFP;if(P===null){var O,M;if((O=K.doc.scrollTop())>0){P=((M=document.elementFromPoint(0,O+a(window).height()-1))==null||M.tagName.toUpperCase()=="HTML")}if((O=K.doc.scrollLeft())>0){P=((M=document.elementFromPoint(O+a(window).width()-1,0))==null||M.tagName.toUpperCase()=="HTML")}}if(P){L-=K.doc.scrollLeft();Q-=K.doc.scrollTop()}var N=a(document.elementFromPoint(L,Q));if(!K.rootEl.el.find(N).length){return null}else{if(N.is("#s-l-placeholder")||N.is("#s-l-hint")){return null}else{if(!N.is("li")){N=N.closest("li");return N[0]?N:null}else{if(N.is("li")){return N}}}}}function j(P,O){var L=O.oEl;if(!L||!O.oElOld){return}var N=L.outerHeight(false),M=P.pageY-L.offset().top;if(14>M){H.insertZonePlus?G(P,L,7>M):i(P,L)}else{if(N-14<M){H.insertZonePlus?F(P,L,N-7<M):b(P,L)}}}function i(O,L){if(a("#s-l-hint-wrapper",K.rootEl.el).length){p.unwrap()}if(O.pageX-L.offset().left<H.insertZone){if((H.maxLevels!==false&&!v(false))||(L.prev("#s-l-placeholder").length)){p.css("display","none");return}L.before(p)}else{var M=L.children(),N=L.children(H.listSelector).first();if((H.maxLevels!==false&&!v(true))||(N.children().first().is("#s-l-placeholder"))){p.css("display","none");return}if(!N.length){M.first().after(p);p.wrap(t)}else{N.prepend(p)}if(K.oEl){r(L)}}p.css("display","block");K.isAllowed=H.isAllowed(K.cEl.el,p,p.parents("li").first())}function G(P,L,O){if(a("#s-l-hint-wrapper",K.rootEl.el).length){p.unwrap()}if(!O&&P.pageX-L.offset().left>H.insertZone){var M=L.children(),N=L.children(H.listSelector).first();if((H.maxLevels!==false&&!v(true))||(N.children().first().is("#s-l-placeholder"))){p.css("display","none");return}if(!N.length){M.first().after(p);p.wrap(t)}else{N.prepend(p)}if(K.oEl){r(L)}}else{if((H.maxLevels!==false&&!v(false))||(L.prev("#s-l-placeholder").length)){p.css("display","none");return}L.before(p)}p.css("display","block");K.isAllowed=H.isAllowed(K.cEl.el,p,p.parents("li").first())}function b(O,L){if(a("#s-l-hint-wrapper",K.rootEl.el).length){p.unwrap()}if(O.pageX-L.offset().left<H.insertZone){if((H.maxLevels!==false&&!v(false))||(L.next("#s-l-placeholder").length)){p.css("display","none");return}L.after(p)}else{var M=L.children(),N=L.children(H.listSelector).last();if((H.maxLevels!==false&&!v(true))||(N.children().last().is("#s-l-placeholder"))){p.css("display","none");return}if(N.length){M.last().append(p)}else{L.append(p);p.wrap(t)}if(K.oEl){r(L)}}p.css("display","block");K.isAllowed=H.isAllowed(K.cEl.el,p,p.parents("li").first())}function F(P,L,O){if(a("#s-l-hint-wrapper",K.rootEl.el).length){p.unwrap()}if(!O&&P.pageX-L.offset().left>H.insertZone){var M=L.children(),N=L.children(H.listSelector).last();if((H.maxLevels!==false&&!v(true))||(N.children().last().is("#s-l-placeholder"))){p.css("display","none");return}if(N.length){M.last().append(p)}else{L.append(p);p.wrap(t)}if(K.oEl){r(L)}}else{if((H.maxLevels!==false&&!v(false))||(L.next("#s-l-placeholder").length)){p.css("display","none");return}L.after(p)}p.css("display","block");K.isAllowed=H.isAllowed(K.cEl.el,p,p.parents("li").first())}function r(L){L.removeClass("s-l-closed").addClass("s-l-open");L.children(H.listSelector).css("display","block");var M=L.children("div").children(".s-l-opener").first();if(H.opener.as=="html"){M.html(H.opener.close)}else{if(H.opener.as=="class"){M.addClass(H.opener.close).removeClass(H.opener.open)}}}function D(L){L.removeClass("s-l-open").addClass("s-l-closed");L.children(H.listSelector).css("display","none");var M=L.children("div").children(".s-l-opener").first();if(H.opener.as=="html"){M.html(H.opener.open)}else{if(H.opener.as=="class"){M.addClass(H.opener.open).removeClass(H.opener.close)}}}function I(L){var P=0;var N=L.children(H.listSelector);if(N.length){P++;var O=0;var M=0;N.find("li").each(function(Q){M=I(a(this));if(O<M){O=M}});if(O){P=P+O}}return P}function k(L,M){L.data("insideLevels",M)}function y(L){var O=0;var N=K.rootEl.el;var M=L.closest(H.listSelector);while(!M.is(N)){O++;M=M.parent().closest(H.listSelector)}return O}function m(L,M){L.data("upperLevels",M)}function v(L){var N=K.cEl.el.data("insideLevels");var M=K.oEl.data("upperLevels");return H.maxLevels>M+N+(L?1:0)}function g(L){var P=K.rootEl.el;var M=L.parent(H.listSelector);k(L,I(L));m(L,y(L));var Q=null;L.find("li").each(function(){Q=a(this);k(Q,I(Q));m(Q,y(Q))});var O=0;var N=null;while(!M.is(P)&&O<50){N=M.parent("li");k(N,I(N));M=N.parent(H.listSelector);O++}}function q(L){var M=L.el[0].style;L.el.removeClass(H.currElClass+" s-l-current");M.top="0";M.left="0";M.position="relative";M.width="auto"}function c(){a(H.listSelector,K.rootEl.el).each(function(L){if(!a(this).children().length){a(this).prev("div").children(".s-l-opener").first().remove();a(this).remove()}})}};a.fn.sortableListsToArray=function(c,d){c=c||[];var b=0;this.children("li").each(function(){var e=a(this),f={},g=e.attr("id");if(!g){console.log(e);throw"Previous item in console.log has no id. It is necessary to create the array."}f.id=g;f.parentId=d;f.value=e.data("value");f.order=b;c.push(f);e.children("ul,ol").sortableListsToArray(c,g);b++});return c};a.fn.sortableListsToHierarchy=function(){var c=[],b=0;a(this).children("li").each(function(){var d=a(this),e={},f=d.attr("id");if(!f){console.log(d);throw"Previous item in console.log has no id. It is necessary to create the array."}e.id=f;e.value=d.data("value");e.order=b;c.push(e);e.children=d.children("ul,ol").sortableListsToHierarchy();b++});return c};a.fn.sortableListsToString=function(b,c){b=b||[];c=c||"no-parent";a(this).children("li").each(function(){var d=a(this),f=d.attr("id"),e=f?f.match(/(.+)[-=_](.+)/):null;if(!e){console.log(d);throw"Previous item in console.log has no id or id is not in required format xx_yy, xx-yy or xx=yy. It is necessary to create valid string."}b.push(e[1]+"["+e[2]+"]="+c);a(this).children("ul,ol").sortableListsToString(b,e[2])});return b.join("&")}}(jQuery));