(function(a){a.fn.sortableLists=function(k){var B=a("body").css("position","relative"),s={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(B.css("margin-top")),left:0-parseInt(B.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:false,open:"",close:"",openerCss:{"float":"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},maxLevels:false,listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,insertZonePlus:false,scroll:20,ignoreClass:"",isAllowed:function(J,L,K){return true},onDragStart:function(K,J){return true},onChange:function(J){return true},complete:function(J){return true}},F=a.extend(true,{},s,k),n=a("<"+F.listSelector+" />").prependTo(B).attr("id","s-l-base").css(F.baseCss).addClass(F.listsClass+" "+F.baseClass),p=a("<li />").attr("id","s-l-placeholder").css(F.placeholderCss).addClass(F.placeholderClass),v=a("<li />").attr("id","s-l-hint").css(F.hintCss).addClass(F.hintClass),i=a("<"+F.listSelector+" />").attr("id","s-l-hint-wrapper").addClass(F.listsClass+" "+F.hintWrapperClass).css(F.listsCss).css(F.hintWrapperCss),x=a("<span />").addClass("s-l-opener "+F.opener.openerClass).css(F.opener.openerCss).on("mousedown touchstart",function(K){var J=a(this).closest("li");if(J.hasClass("s-l-closed")){t(J)}else{w(J)}return false});if(F.opener.as=="class"){x.addClass(F.opener.close)}else{if(F.opener.as=="html"){x.html(F.opener.close)}else{console.error("jQuerySortableLists opener as background image has been removed with release 2.0.0. Use html instead please.")}}var m={isDragged:false,isRelEFP:null,oEl:null,rootEl:{el:a(this),offset:null,rootElClass:a(this).attr("class")},cEl:null,placeholderParentLi:null,upScroll:false,downScroll:false,pX:0,pY:0,cX:0,cY:0,isAllowed:true,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:a(document),win:a(window)};if(F.opener.active){if(!F.opener.open){throw"Opener.open value is not defined. It should be valid url, html or css class."}if(!F.opener.close){throw"Opener.close value is not defined. It should be valid url, html or css class."}var D=null;a(this).find("li").each(function(){D=a(this);if(D.children(F.listSelector).length){x.clone(true).prependTo(D.children("div").first());if(!D.hasClass("s-l-open")){w(D)}else{t(D)}}})}return this.on("mousedown touchstart",function(M){var L=a(M.target);if(m.isDragged!==false||(F.ignoreClass&&L.hasClass(F.ignoreClass))){return}M.preventDefault();if(M.type==="touchstart"){I(M)}var K=L.closest("li"),J=a(this);if(K[0]){F.onDragStart(M,K);f(M,K,J)}});function f(P,L,K){m.isDragged=true;var R=parseInt(L.css("margin-top")),N=parseInt(L.css("margin-bottom")),J=parseInt(L.css("margin-left")),S=parseInt(L.css("margin-right")),Q=L.offset(),O=L.innerHeight();m.rootEl={el:K,offset:K.offset(),rootElClass:K.attr("class")};m.cEl={el:L,mT:R,mL:J,mB:N,mR:S,offset:Q,insideLevels:o(L)};m.cEl.xyOffsetDiff={X:P.pageX-m.cEl.offset.left,Y:P.pageY-m.cEl.offset.top};m.cEl.el.addClass("s-l-current "+F.currElClass);L.before(p);var M=m.placeholderNode=a("#s-l-placeholder");L.css({width:L.width(),position:"absolute",top:Q.top-R,left:Q.left-J}).prependTo(n);M.css({display:"block",height:O});v.css("height",O);m.doc.on("mousemove touchmove",A).on("mouseup touchend touchcancel",C)}function A(M){if(m.isDragged){var J=m.cEl,L=m.doc,K=m.win;if(M.type==="touchmove"){I(M)}if(!M.pageX){e(M)}if(M.clientY<50&&L.scrollTop()>m.rootEl.offset.top-10){if(!m.upScroll){y(M)}else{M.pageY=M.pageY-F.scroll;a("html, body").each(function(N){a(this).scrollTop(a(this).scrollTop()-F.scroll)});h(M)}}else{if(K.height()-M.clientY<50&&L.scrollTop()+K.height()<m.rootEl.offset.top+m.rootEl.el.outerHeight(false)+10){if(!m.downScroll){q(M)}else{M.pageY=M.pageY+F.scroll;a("html, body").each(function(N){a(this).scrollTop(a(this).scrollTop()+F.scroll)});h(M)}}else{l(m)}}m.oElOld=m.oEl;J.el[0].style.visibility="hidden";m.oEl=oEl=r(M.pageX,M.pageY);J.el[0].style.visibility="visible";g(M,m);c(M,m)}}function C(N){var M=m.cEl,J=a("#s-l-hint",m.rootEl.el),P=v[0].style,O=null,L=false,K=a("#s-l-hint-wrapper");if(N.type==="touchend"||N.type==="touchcancel"){I(N)}if(P.display=="block"&&J.length&&m.isAllowed){O=J;L=true}else{O=m.placeholderNode;L=false}offset=O.offset();M.el.animate({left:offset.left-m.cEl.mL,top:offset.top-m.cEl.mT},250,function(){b(M);O.after(M.el[0]);O[0].style.display="none";P.display="none";J.remove();K.removeAttr("id").removeClass(F.hintWrapperClass);if(K.length){K.prev("div").append(x.clone(true))}if(L){m.placeholderNode.slideUp(150,function(){m.placeholderParentLi=(!m.placeholderNode.parent().is(m.rootEl.el))?m.placeholderNode.parent().closest("li"):null;m.placeholderNode.remove();E();F.onChange(M.el);F.complete(M.el);m.isDragged=false})}else{m.placeholderNode.remove();E();F.complete(M.el);m.isDragged=false}});l(m);m.doc.unbind("mousemove touchmove",A).unbind("mouseup touchend touchcancel",C)}function y(J){if(m.upScroll){return}m.upScroll=setInterval(function(){m.doc.trigger("mousemove")},50)}function q(J){if(m.downScroll){return}m.downScroll=setInterval(function(){m.doc.trigger("mousemove")},50)}function h(J){m.pY=J.pageY;m.pX=J.pageX;m.cY=J.clientY;m.cX=J.clientX}function e(J){J.pageY=m.pY;J.pageX=m.pX;J.clientY=m.cY;J.clientX=m.cX}function l(J){clearInterval(J.upScroll);clearInterval(J.downScroll);J.upScroll=J.downScroll=false}function I(J){J.pageX=J.originalEvent.changedTouches[0].pageX;J.pageY=J.originalEvent.changedTouches[0].pageY;J.screenX=J.originalEvent.changedTouches[0].screenX;J.screenY=J.originalEvent.changedTouches[0].screenY}function c(L,K){var J=K.cEl;J.el.css({top:L.pageY-J.xyOffsetDiff.Y-J.mT,left:L.pageX-J.xyOffsetDiff.X-J.mL})}function r(J,O){if(!document.elementFromPoint){return null}var N=m.isRelEFP;if(N===null){var M,K;if((M=m.doc.scrollTop())>0){N=((K=document.elementFromPoint(0,M+a(window).height()-1))==null||K.tagName.toUpperCase()=="HTML")}if((M=m.doc.scrollLeft())>0){N=((K=document.elementFromPoint(M+a(window).width()-1,0))==null||K.tagName.toUpperCase()=="HTML")}}if(N){J-=m.doc.scrollLeft();O-=m.doc.scrollTop()}var L=a(document.elementFromPoint(J,O));if(!m.rootEl.el.find(L).length){return null}else{if(L.is("#s-l-placeholder")||L.is("#s-l-hint")){return null}else{if(!L.is("li")){L=L.closest("li");return L[0]?L:null}else{if(L.is("li")){return L}}}}}function g(N,M){var J=M.oEl;if(!J||!M.oElOld){return}var L=J.outerHeight(false),K=N.pageY-J.offset().top;if(14>K){F.insertZonePlus?d(N,J,7>K):j(N,J)}else{if(L-14<K){F.insertZonePlus?z(N,J,L-7<K):H(N,J)}}}function j(M,J){if(a("#s-l-hint-wrapper",m.rootEl.el).length){v.unwrap()}if(M.pageX-J.offset().left<F.insertZone){if((F.maxLevels!==false&&!G(false))||(J.prev("#s-l-placeholder").length)){v.css("display","none");return}J.before(v)}else{var K=J.children(),L=J.children(F.listSelector).first();if((F.maxLevels!==false&&!G(true))||(L.children().first().is("#s-l-placeholder"))){v.css("display","none");return}if(!L.length){K.first().after(v);v.wrap(i)}else{L.prepend(v)}if(m.oEl){t(J)}}v.css("display","block");m.isAllowed=F.isAllowed(m.cEl.el,v,v.parents("li").first())}function d(N,J,M){if(a("#s-l-hint-wrapper",m.rootEl.el).length){v.unwrap()}if(!M&&N.pageX-J.offset().left>F.insertZone){var K=J.children(),L=J.children(F.listSelector).first();if((F.maxLevels!==false&&!G(true))||(L.children().first().is("#s-l-placeholder"))){v.css("display","none");return}if(!L.length){K.first().after(v);v.wrap(i)}else{L.prepend(v)}if(m.oEl){t(J)}}else{if((F.maxLevels!==false&&!G(false))||(J.prev("#s-l-placeholder").length)){v.css("display","none");return}J.before(v)}v.css("display","block");m.isAllowed=F.isAllowed(m.cEl.el,v,v.parents("li").first())}function H(M,J){if(a("#s-l-hint-wrapper",m.rootEl.el).length){v.unwrap()}if(M.pageX-J.offset().left<F.insertZone){if((F.maxLevels!==false&&!G(false))||(J.next("#s-l-placeholder").length)){v.css("display","none");return}J.after(v)}else{var K=J.children(),L=J.children(F.listSelector).last();if((F.maxLevels!==false&&!G(true))||(L.children().last().is("#s-l-placeholder"))){v.css("display","none");return}if(L.length){K.last().append(v)}else{J.append(v);v.wrap(i)}if(m.oEl){t(J)}}v.css("display","block");m.isAllowed=F.isAllowed(m.cEl.el,v,v.parents("li").first())}function z(N,J,M){if(a("#s-l-hint-wrapper",m.rootEl.el).length){v.unwrap()}if(!M&&N.pageX-J.offset().left>F.insertZone){var K=J.children(),L=J.children(F.listSelector).last();if((F.maxLevels!==false&&!G(true))||(L.children().last().is("#s-l-placeholder"))){v.css("display","none");return}if(L.length){K.last().append(v)}else{J.append(v);v.wrap(i)}if(m.oEl){t(J)}}else{if((F.maxLevels!==false&&!G(false))||(J.next("#s-l-placeholder").length)){v.css("display","none");return}J.after(v)}v.css("display","block");m.isAllowed=F.isAllowed(m.cEl.el,v,v.parents("li").first())}function t(J){J.removeClass("s-l-closed").addClass("s-l-open");J.children(F.listSelector).css("display","block");var K=J.children("div").children(".s-l-opener").first();if(F.opener.as=="html"){K.html(F.opener.close)}else{if(F.opener.as=="class"){K.addClass(F.opener.close).removeClass(F.opener.open)}}}function w(J){J.removeClass("s-l-open").addClass("s-l-closed");J.children(F.listSelector).css("display","none");var K=J.children("div").children(".s-l-opener").first();if(F.opener.as=="html"){K.html(F.opener.open)}else{if(F.opener.as=="class"){K.addClass(F.opener.open).removeClass(F.opener.close)}}}function o(J){var N=0;var L=J.children(F.listSelector);if(L.length){N++;var M=0;var K=0;L.find("li").each(function(O){K=o(a(this));if(M<K){M=K}});if(M){N=N+M}}return N}function u(J){var M=0;var L=m.rootEl.el;var K=J.closest(F.listSelector);while(!K.is(L)){M++;K=K.parent().closest(F.listSelector)}return M}function G(J){return F.maxLevels>m.cEl.insideLevels+u(m.oEl)+(J?1:0)}function b(J){var K=J.el[0].style;J.el.removeClass(F.currElClass+" s-l-current");K.top="0";K.left="0";K.position="relative";K.width="auto"}function E(){a(F.listSelector,m.rootEl.el).each(function(J){if(!a(this).children().length){a(this).prev("div").children(".s-l-opener").first().remove();a(this).remove()}})}};a.fn.sortableListsToArray=function(c,d){c=c||[];var b=0;this.children("li").each(function(){var e=a(this),f={},g=e.attr("id");if(!g){console.log(e);throw"Previous item in console.log has no id. It is necessary to create the array."}f.id=g;f.parentId=d;f.value=e.data("value");f.order=b;c.push(f);e.children("ul,ol").sortableListsToArray(c,g);b++});return c};a.fn.sortableListsToHierarchy=function(){var c=[],b=0;a(this).children("li").each(function(){var d=a(this),e={},f=d.attr("id");if(!f){console.log(d);throw"Previous item in console.log has no id. It is necessary to create the array."}e.id=f;e.value=d.data("value");e.order=b;c.push(e);e.children=d.children("ul,ol").sortableListsToHierarchy();b++});return c};a.fn.sortableListsToString=function(b,c){b=b||[];c=c||"no-parent";a(this).children("li").each(function(){var d=a(this),f=d.attr("id"),e=f?f.match(/(.+)[-=_](.+)/):null;if(!e){console.log(d);throw"Previous item in console.log has no id or id is not in required format xx_yy, xx-yy or xx=yy. It is necessary to create valid string."}b.push(e[1]+"["+e[2]+"]="+c);a(this).children("ul,ol").sortableListsToString(b,e[2])});return b.join("&")}}(jQuery));